From 71d244d19ae35764fcb56f74f66bfb4c39cc8189 Mon Sep 17 00:00:00 2001
From: mkamat <mkamat@libertyglobal.com>
Date: Tue, 17 Aug 2021 15:41:06 -0700
Subject: [PATCH] fix request sent instead of renew ( OFW-1791 )

---
 ClntMessages/ClntMsgRequest.cpp | 7 +++++--
 ClntMessages/ClntMsgRequest.h   | 2 +-
 ClntTransMgr/ClntTransMgr.cpp   | 7 +++++--
 3 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/ClntMessages/ClntMsgRequest.cpp b/ClntMessages/ClntMsgRequest.cpp
index 5d30e099..a1d9059f 100644
--- a/ClntMessages/ClntMsgRequest.cpp
+++ b/ClntMessages/ClntMsgRequest.cpp
@@ -31,7 +31,7 @@
 /*
  * opts - options list WITHOUT serverDUID
  */
-TClntMsgRequest::TClntMsgRequest(TOptList opts, int iface)
+TClntMsgRequest::TClntMsgRequest(TOptList opts, int iface, bool sendRequest)
     :TClntMsg(iface, SPtr<TIPv6Addr>(), REQUEST_MSG) {
     IRT = REQ_TIMEOUT;
     MRT = REQ_MAX_RT;
@@ -127,7 +127,10 @@ TClntMsgRequest::TClntMsgRequest(TOptList opts, int iface)
     appendElapsedOption();
     appendAuthenticationOption();
     IsDone = false;
-    send();
+    if(sendRequest)
+    {
+      send();
+    }
 }
 
 TClntMsgRequest::TClntMsgRequest(List(TAddrIA) IAs,
diff --git a/ClntMessages/ClntMsgRequest.h b/ClntMessages/ClntMsgRequest.h
index 9bc973de..771bf10f 100644
--- a/ClntMessages/ClntMsgRequest.h
+++ b/ClntMessages/ClntMsgRequest.h
@@ -18,7 +18,7 @@ class TClntIfaceMgr;
 class TClntMsgRequest : public TClntMsg
 {
   public:
-    TClntMsgRequest(TOptList opts, int iface);
+    TClntMsgRequest(TOptList opts, int iface, bool sendRequest = true);
     TClntMsgRequest(List(TAddrIA) requestIALst,
                     SPtr<TDUID> srvDUID,
                     int iface);
diff --git a/ClntTransMgr/ClntTransMgr.cpp b/ClntTransMgr/ClntTransMgr.cpp
index 6994b64f..a02db47e 100644
--- a/ClntTransMgr/ClntTransMgr.cpp
+++ b/ClntTransMgr/ClntTransMgr.cpp
@@ -802,8 +802,11 @@ void TClntTransMgr::sendRequest(TOptList requestOptions, int iface)
 	    (*opt)->getOptType() == OPTION_AUTH)
             opt = requestOptions.erase(opt);
     }
-    SPtr<TClntMsg> ptr = new TClntMsgRequest(requestOptions, iface);
-    Transactions.append(ptr);
+    SPtr<TClntMsg> ptr = new TClntMsgRequest(requestOptions, iface,false);
+    if (ptr)
+    {
+      Transactions.append(ptr);
+    }
 }
 
 void TClntTransMgr::sendRenew()
-- 
2.24.0

